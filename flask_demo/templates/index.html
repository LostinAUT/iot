<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>é¢å…»è±†è±†</title>
<!--è®¾ç½®æ˜¯å¦ä¸ºç¼©æ”¾æ¨¡å¼ -->
<style>
	.images {
		display: flex;
		flex-direction: column;
		justify-content: center;
		gap: 20px;
	}
	.images img {
		width: 370px;
		height: auto;
		border: 1px solid #061537;
	}
	.visual_chart_text1 {
            position: absolute;
            bottom: 0; /* å°†å…¶æ”¾ç½®åœ¨å®¹å™¨çš„åº•éƒ¨ */
            left: 50%;
            transform: translateX(-50%); /* æ°´å¹³å±…ä¸­å¯¹é½ */
            text-align: center; /* ç¡®ä¿æ–‡æœ¬å±…ä¸­ */
            width: 100%; /* è®©å®¹å™¨å®½åº¦ä¸çˆ¶å®¹å™¨ä¸€è‡´ */
        }
	.record-button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #add8e6;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    .record-button:hover {
            background-color: #87cefa; /* é¼ æ ‡æ‚¬åœæ—¶çš„é¢œè‰² */
       }
    .visual_conBot1 {
            width: 80%;
            max-width: 800px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #002f5f; /* æ·±è“è‰²èŠå¤©æ¡†èƒŒæ™¯ */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
	.visual_conBot img {
		width: 100%;
		max-width: 200px;
		margin-bottom: 10px;
	}
	.visual_chart_text2 {
		width: 100%;
            height: 100%;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #f0f0f0; /* æ·±è“è‰²èŠå¤©æ¡†èƒŒæ™¯ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
	}
	.chat-box {
		width: 100%;
		height: calc(100% - 60px);
		overflow-y: auto;
		padding: 10px;
		border-bottom: 1px solid #ccc;
		margin-bottom: 10px;
	}
	.chat-message {
		margin: 10px 0;
		padding: 10px;
		border-radius: 5px;
		width: fit-content;
	}
	.chat-message.user {
		align-self: flex-end;
		background-color: #d9f2ff;
	}
	.chat-message.ai {
		align-self: flex-start;
		background-color: #f1f8e9;
	}
	.input-group {
		width: 100%;
		display: flex;
		justify-content: center;
		align-items: center;
	}
	.input-group input {
	   	flex: 1;
		padding: 10px;
		border: 1px solid #ccc;
		border-radius: 5px;
		margin-right: 10px;
		max-width: 400px;
	}
	.input-group button {
		padding: 10px;
		border: none;
		background-color: #007bff;
		color: white;
		border-radius: 5px;
		cursor: pointer;
	}
	.input-group button:hover {
		background-color: #0056b3;
	}
	#radarChart {
		width: 100%;
		height: 100%;
		margin: 0 auto;
	}

	.swiper-container {
		width: 100%;
		height: 100%;
	}

	.swiper-slide {
		display: flex;
		justify-content: center;
		align-items: center;
	}

	.visual_box1 {
		width: 100%;
		text-align: center;
		padding: 20px;
        }
	.visual_title {
		font-size: 24px;
		margin-bottom: 10px;
	}
	.visual_chart1 {
		font-size: 20px;
		color: lightgreen;
		line-height: 2;
	}
	.suggestion {
		display: none;
		animation: fadeIn 2s forwards;
	}
	@keyframes fadeIn {
		from { opacity: 0; }
		to { opacity: 1; }
	}
</style>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- æ–° Bootstrap æ ¸å¿ƒ CSS æ–‡ä»¶ --> 
<link rel="stylesheet" type="text/css" href="https://apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.css">
<!-- jQueryæ–‡ä»¶ã€‚åŠ¡å¿…åœ¨bootstrap.min.js ä¹‹å‰å¼•å…¥ --> 
<script src="static/js/jquery.min.js"></script>
<!-- æœ€æ–°çš„ Bootstrap æ ¸å¿ƒ JavaScript æ–‡ä»¶ --> 
<script src="static/js/bootstrap.min.js"></script>
<!--echarts JS-->
<script src="static/js/echarts.min.js"></script>
<!-- è½®æ’­swiperæ–‡ä»¶ -->
<link rel="stylesheet" type="text/css" href="static/css/swiper.min.css">
<script src="static/js/swiper.min.js"></script>
<!--ç•Œé¢æ ·å¼-->
<script src="static/js/visual.js"></script>
<script src="static/js/china.js"></script>
<script src="static/js/chartMap.js"></script>
<link rel="stylesheet" type="text/css" href="static/css/visual.css">
<!--åŠ è½½ Socket.IO å®¢æˆ·ç«¯åº“-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>

</head>
<body class="ksh">
<script src="https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/0.1.0-beta.5/libs/cn/index.js"></script>
      <script>
          new CozeWebSDK.WebChatClient({
            config: {
              bot_id: '7394662760858599465',
            },
            componentProps: {
              title: 'Coze',
            },
          });
      </script>
	</div>
	<div class="visual">
		<div class="visual_left">
			<div class="visual_box">
				<div class="visual_title">
					<span>å¿ƒç‡å˜åŒ–</span>
					<img src="static/images/2.png">
				</div>
				<div id="chart25" style="width: 400px; height: 265px;">
					<canvas id="healthChart"></canvas>
				</div>

				<script>
					var chartDom = document.getElementById('chart25');
					var myChart = echarts.init(chartDom);

					var option = {
						tooltip: {
							trigger: 'axis'
						},
						legend: {
							data: ['HeartRate'],
							textStyle: {
								color: '#ffffff'
							}
						},
						xAxis: {
							type: 'category',
							boundaryGap: false,
							data: [],
							axisLabel: {
								color: '#ffffff'
							}
						},
						yAxis: {
							type: 'value',
							axisLabel: {
								color: '#ffffff'
							}
						},
						series: [
							{
								name: 'HeartRate',
								type: 'line',
								data: [],
								itemStyle: {
									normal: {
										color: 'rgb(137,189,27)'
									}
								}
							}
						]
					};

					myChart.setOption(option);

					var socket = io();

					socket.on('update_data', function(data) {
						document.getElementById('heart_rate').innerText = data.heart_rate;
						document.getElementById('spo2').innerText = data.spo2;
						document.getElementById('temperature').innerText = data.temperature;
						document.getElementById('humidity').innerText = data.humidity;

						var now = new Date().toLocaleTimeString();

						// æ·»åŠ æ–°çš„æ•°æ®ç‚¹
						option.xAxis.data.push(now);
						option.series[0].data.push(data.heart_rate);

						// é™åˆ¶æ˜¾ç¤ºçš„æ•°æ®ç‚¹æ•°ï¼Œåªæ˜¾ç¤ºæœ€è¿‘10ä¸ªæ•°æ®ç‚¹
						if (option.xAxis.data.length > 10) {
							option.series[0].data.shift();
							option.xAxis.data.shift();
						}

						// æ›´æ–°å›¾è¡¨
						myChart.setOption(option);
					});
				</script>

			</div>
<!--			<div class="visual_box">-->
<!--				<div class="visual_title">-->
<!--					<span>å¤©æ°”ä¿¡æ¯</span>-->
<!--					<img src="static/images/2.png">-->
<!--				</div>-->
<!--				<div class="visual_chart1" id="main26">-->

<!--				</div>-->
<!--&lt;!&ndash;				<div class="images">&ndash;&gt;-->
<!--&lt;!&ndash;					<img src="static/images/wea1.png" alt="Image 1">&ndash;&gt;-->
<!--&lt;!&ndash;				</div>&ndash;&gt;-->

<!--			</div>-->

			<div class="visual_box">
				<div class="visual_title">
					<span>æ¸©æ¹¿åº¦å»ºè®®</span>
					<img src="static/images/2.png">
				</div>
				<div class="visual_chart1" id="main27">

				</div>
			</div>

			<script>
				document.addEventListener("DOMContentLoaded", function() {
					var suggestions = [
						"==================",
						"ğŸŒ¡ é€‚å®œæ¸©åº¦: 26â„ƒ - 28â„ƒ",
                		"ğŸ’§ é€‚å®œæ¹¿åº¦: 50% - 70%",
                		"ğŸ‘€ å»ºè®®ç†ç”±: å¤å­£è¾ƒä¸ºç‚çƒ­æ½®æ¹¿ï¼Œè¿™ä¸ªæ¸©åº¦èŒƒå›´èƒ½è®©æ‚¨æ„Ÿè§‰è¾ƒä¸ºèˆ’é€‚ï¼Œé¿å…è¿‡çƒ­å¼•èµ·ä¸é€‚ã€‚æ¹¿åº¦åœ¨ 50% - 70%ä¹‹é—´ï¼Œæ—¢èƒ½ä¿æŒä¸€å®šçš„æ¹¿æ¶¦åº¦ï¼Œåˆä¸ä¼šè¿‡äºæ½®æ¹¿ï¼Œæœ‰åŠ©äºå‡å°‘é—·çƒ­æ„Ÿã€‚",
                		"=================="
					];
					var main2Div = document.getElementById("main27");
					var index = 0;

					function showNextSuggestion() {
						if (index < suggestions.length) {
							var suggestionParagraph = document.createElement("p");
							suggestionParagraph.textContent = suggestions[index];
							suggestionParagraph.classList.add("suggestion");
							main2Div.appendChild(suggestionParagraph);
							suggestionParagraph.style.display = "block";
							index++;
							setTimeout(showNextSuggestion, 2000); // æ¯3ç§’æ˜¾ç¤ºä¸€ä¸ªæ–°å»ºè®®
						}
					}

					showNextSuggestion();
				});
			</script>

		</div>
		<div class="visual_con">
			<div class="visual_conTop">
				<div class="visual_conTop_box visual_conTop1">
					<div>
						<h3>è¡€æ°§æŒ‡æ•° %</h3>
						<p id="spo2">N/A</p>
						<div class="conTop_smil">
						</div>
					</div>
				</div>
				<div class="visual_conTop_box visual_conTop2">
					<div>
						<h3>å¿ƒç‡ bpm</h3>
						<p id="heart_rate">N/A</p>
						<div class="conTop_smil">
						</div>
						<!-- è­¦å‘ŠéŸ³é¢‘ -->
<!--						<audio id="warning-audio" src="static/audio/warning.mp3"></audio>-->
					</div>
				</div>
				<div class="visual_conTop_box visual_conTop1">
					<div>
						<h3>å½“å‰æ¸©åº¦ *C</h3>
						<p id="temperature">N/A</p>
						<div class="conTop_smil">
						</div>
					</div>
				</div>
				<div class="visual_conTop_box visual_conTop2">
					<div>
						<h3>å½“å‰æ¹¿åº¦ %</h3>
						<p id="humidity">N/A</p>
						<div class="conTop_smil">
							<a class="null">null</a>
<!--							<a class="xd"><span>-2%</span><i class="fa fa-long-arrow-down"></i></a>-->
						</div>
					</div>
				</div>
				<div class="clear"></div>
			</div>

			<div class="visual_conBot">
				<div class="visual_chart_text2">
					<div class="chat-box" id="chat-box">
            	<!-- Chat messages will be appended here -->
        			</div>
<!--					<div class="input-group">-->
<!--						<input type="text" id="user-input" placeholder="Type your message...">-->
<!--						<button onclick="sendMessage()">å‘é€</button>-->
<!--					</div>-->
				</div>
				<div class="visual_chart_text1">
<!--					<button class="record-button" onclick="startRecording()">å¼€å§‹å½•éŸ³</button>-->
					<button class="record-button" onclick="sendMessage()">å‘èµ·èŠå¤©</button>
				</div>
			</div>
		</div>
		<div class="visual_right">
			<div class="visual_box">
				<div class="visual_title">
					<span>è€äººæ„å¤–äº‹ä»¶ç»Ÿè®¡</span>
					<img src="static/images/2.png">
				</div>
				<div class="swiper-container visual_swiper1 visual_chart">
					<div class="swiper-wrapper">
						<div class="swiper-slide"  id="main3"></div>
						<div class="swiper-slide"  id="main31"></div>
<!--							<div id="radarChart" style="width: 600px; height: 400px;"></div>-->
					</div>
				</div>
				<script>
					// Example data
					var radarData = {
						indicator: [
							{ name: 'æ‘”å€’', max: 100 },
							{ name: 'çªå‘ç–¾ç—…', max: 100 },
							{ name: 'è¿·è·¯', max: 100 },
							{ name: 'æƒ…ç»ªå¼‚å¸¸', max: 100 },
							{ name: 'å…¶ä»–', max: 100 }
						],
						data: [
							{
								value: [80, 70, 85, 90, 75],
								name: 'æ„å¤–äº‹ä»¶ç»Ÿè®¡'
							}
						]
					};

					function initRadarChart() {
						var radarChart = echarts.init(document.getElementById('radarChart'));
						var option = {
							tooltip: {},
							legend: {
								data: ['æ„å¤–äº‹ä»¶ç»Ÿè®¡'],
								textStyle: {
									color: '#ffffff'
								}
							},
							radar: {
								indicator: radarData.indicator,
								shape: 'circle',
								splitLine: {
									lineStyle: {
										color: 'rgba(255, 255, 255, 0.5)'
									}
								},
								splitArea: {
									areaStyle: {
										color: ['rgba(255, 255, 255, 0.1)', 'rgba(255, 255, 255, 0.1)']
									}
								},
								axisLine: {
									lineStyle: {
										color: 'rgba(255, 255, 255, 0.5)'
									}
								}
							},
							series: [{
								name: 'æ„å¤–äº‹ä»¶ç»Ÿè®¡',
								type: 'radar',
								data: radarData.data,
								itemStyle: {
									color: '#ff6347'
								},
								lineStyle: {
									color: '#ff6347'
								},
								areaStyle: {
									color: 'rgba(255, 99, 71, 0.5)'
								}
							}],
							backgroundColor: '#00008b'
						};
						radarChart.setOption(option);
					}
					window.onload = function() {
<!--						fetchData()-->
<!--						initRadarChart();-->
					var myChart3 = echarts.init(document.getElementById('main3'));
					myChart3.setOption(option3);
					var myChart31 = echarts.init(document.getElementById('main31'));
					myChart31.setOption(option31);
					var mySwiper1 = new Swiper('.visual_swiper1', {
						autoplay: true,//å¯é€‰é€‰é¡¹ï¼Œè‡ªåŠ¨æ»‘åŠ¨
						speed:800,//å¯é€‰é€‰é¡¹ï¼Œæ»‘åŠ¨é€Ÿåº¦
						autoplay: {
							delay: 500000,//1ç§’åˆ‡æ¢ä¸€æ¬¡
						  },
					})
					};
				</script>
			</div>
			<div class="visual_box">
				<div class="visual_title">
					<span>æ‘„åƒå¤´</span>
					<img src="static/images/2.png">
				</div>
				<div class="images">
					<img id="down" alt="Image3" src="{{ url1 }}">
					<img id="fight" alt="Image4" src="{{ url2 }}">
				</div>
			</div>
		</div>
		<div class="clear"></div>
	</div>

	<script>
<!--		document.addEventListener('DOMContentLoaded', function() {-->
<!--				checkHeartRate();-->
<!--		});-->

		function startRecording() {
			fetch('/start-recording', {
				method: 'POST'
			})
			.then(response => response.json())
			.then(data => {
				console.log('Recording started:', data);
				alert('å½•éŸ³å·²å¼€å§‹');
			})
			.catch((error) => {
				console.error('Error:', error);
				alert('å½•éŸ³å¤±è´¥');
			});
		}

<!--		 function checkHeartRate() {-->
<!--			const heartRateElement = document.getElementById('heart-rate');-->
<!--			const heartRate = parseInt(heartRateElement.textContent);-->
<!--			if (heartRate > 100) { // 100ä¸ºå¿ƒç‡é˜ˆå€¼-->
<!--				alert('è­¦å‘Šï¼šå¿ƒç‡è¿‡é«˜ï¼');-->
<!--				const audio = document.getElementById('warning-audio');-->
<!--				audio.load();-->
<!--				audio.play();-->
<!--			}-->
<!--		}-->

		function appendMessage(content, className) {
            const message = document.createElement('div');
            message.className = 'chat-message ' + className;
            message.textContent = content;
            document.getElementById('chat-box').appendChild(message);
            message.scrollIntoView();
        }

        function sendMessage(message) {
            // Append AI's response to chat box
            // appendMessage(message, 'user');

            fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: message }),
            })
            .then(response => response.json())
            .then(data => {
                // Append to chat box
                appendMessage(data.query, 'user');
				setTimeout(() => {
					appendMessage(data.reply, 'ai');
					tts_path = data.tts_path
					const audio = new Audio(tts_path);
                    audio.play();
				}, 100); // å»¶è¿Ÿ 1 ç§’
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

	</script>
	<script type="text/javascript">
		$(function(){
			var a=$('.visualSssf_left a')
			for(var i=0;i<a.length;i++){
				a[i].index=i;
				a[i].onclick=function(){
					for(var i=0;i<a.length;i++){
						a[i].className=''
						}
					this.className='active'
				}
			}

			var sfzcllH=$('.sfzcll_box').height()
			var sfzcllHtwo=sfzcllH-2
			$('.sfzcll_box').css('line-height',sfzcllH+'px')
			$('.sfzcll_smallBk>div').css('line-height',sfzcllHtwo+'px')

			//åˆ é™¤åŠ è½½åŠ¨ç”»
			$('#load').fadeOut(1000)
    		setTimeout(function(){    
    			$('#load').remove()
    		}
    		,1100);
		})

	</script>
</body>
</html>